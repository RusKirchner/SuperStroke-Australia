{% schema %}
{
  "name": "Multiple Product Display",
  "settings": [],
  "blocks": [
    {
      "type": "product_block",
      "name": "Product",
      "settings": [
        {
          "type": "product",
          "id": "selected_product",
          "label": "Select Product"
        }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    {
      "name": "Multiple Product Display",
      "blocks": []
    }
  ]
}
{% endschema %}
{% if section.blocks.size > 0 %}
  <div class="multiple-product-display" style="display: flex; flex-wrap: wrap; gap: 40px; justify-content: center; padding: 30px;">

    {% for block in section.blocks %}
      {% assign product = all_products[block.settings.selected_product] %}
      {% if product %}
        <div class="single-product" style="text-align:center; width: 280px;" data-block-id="{{ block.id }}">
          <!-- Product Image -->
          <div class="product-image-wrapper" style="position: relative;">
            <img 
              id="MainImage-{{ block.id }}" 
              src="{{ product.featured_image | img_url: 'large' }}" 
              alt="{{ product.title }}" 
              class="main-product-image"
              style="max-width: 250px; transition: opacity 0.3s ease;"
            />
          </div>

          <!-- Product Name -->
          <h3 style="margin-top: 10px;">{{ product.title }}</h3>

          <!-- Product Price -->
          <p style="font-size: 18px; font-weight: 500;">{{ product.price | money }}</p>

          <!-- Color Swatches -->
          {% assign color_option_index = -1 %}
          {% for option in product.options_with_values %}
            {% if option.name == 'Color' or option.name == 'Colour' %}
              {% assign color_option_index = forloop.index0 %}
            {% endif %}
          {% endfor %}

          {% if color_option_index >= 0 %}
            <div class="color-swatches" style="margin-top: 15px;">
              {% assign shown_colors = '' %}
              {% for variant in product.variants %}
                {% assign color = variant.options[color_option_index] %}
                {% unless shown_colors contains color %}
                  {% assign color_first_word = color | split: ' ' | first %}
                  <span 
                    class="color-swatch" 
                    data-block-id="{{ block.id }}"
                    data-img="{{ variant.featured_image | img_url: 'large' }}"
                    style="display:inline-block; width:20px; height:20px; border:1px solid #ccc; border-radius:50%; margin:0 5px; background-color: {{ color_first_word | downcase }}; cursor:pointer;"
                    title="{{ color }}"
                  ></span>
                  {% assign shown_colors = shown_colors | append: color | append: ',' %}
                {% endunless %}
              {% endfor %}
            </div>
          {% endif %}
        </div>
      {% endif %}
    {% endfor %}
  </div>

  <!-- JS for swatch click image switching -->
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const swatches = document.querySelectorAll(".color-swatch");

      swatches.forEach(swatch => {
        swatch.addEventListener("click", () => {
          const imgUrl = swatch.getAttribute("data-img");
          const blockId = swatch.getAttribute("data-block-id");
          const img = document.getElementById("MainImage-" + blockId);
          if (img && imgUrl) {
            img.setAttribute("src", imgUrl);
          }
        });
      });
    });
  </script>
{% else %}
  <p style="text-align:center;">No products added.</p>
{% endif %}
<style>
  .multiple-product-display .color-swatches
 {
    position: relative;
}
</style>