{% schema %}
{
  "name": "Scrollable Image Slider",
  "settings": [
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#ffffff"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "alt_text",
          "label": "Alt text",
          "default": "Slide image"
        }
      ]
    }
  ],
  "max_blocks": 20,
  "presets": [
    {
      "name": "Scrollable Image Slider",
      "category": "Media"
    }
  ]
}
{% endschema %}

<div class="swiper-scroll-wrapper" style="background-color: {{ section.settings.background_color }};">
  <div class="swiper mySwiper">
    <div class="swiper-wrapper container">
      {% for block in section.blocks %}
        {% if block.settings.image %}
          <div class="swiper-slide">
            <img
              src="{{ block.settings.image | img_url: 'master' }}"
              alt="{{ block.settings.alt_text }}"
              loading="lazy"
            >
          </div>
        {% endif %}
      {% endfor %}
    </div>
    
<div class="swiper-segmented-progress">
  {% for block in section.blocks %}
    <div class="progress-step"></div>
  {% endfor %}
</div>
  </div>
</div>

<style>
.swiper-scroll-wrapper {
  padding: 20px 0;
}

.swiper {
  width: 100%;
}

.swiper-slide {
  width: auto;
  flex-shrink: 0;
  margin-right: 16px;
}

.swiper-slide img {
  display: block;
  height: auto;
  max-width: 100%;
  border-radius: 10px;
}
.swiper-pagination-progressbar {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 4px;
  background: rgba(0, 0, 0, 0.1);
}

.swiper-pagination-progressbar-fill {
  background: #000; /* You can change this to match your brand */
}

  .swiper-segmented-progress {
    display: flex;
    width: 100%;
    height: 4px;
    margin-top: 10px;
    gap: 4px;
  }
  
  .progress-step {
    flex: 1;
    background-color: rgba(0, 0, 0, 0.15);
    transition: background-color 0.3s;
  }
  
  .progress-step.active {
    background-color: #000;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    new Swiper(".mySwiper", {
      slidesPerView: "auto",
      spaceBetween: 16,
      freeMode: true,
      grabCursor: true,
      mousewheel: {
        forceToAxis: true, // ⬅️ Important: allow scroll only on horizontal axis
        releaseOnEdges: true // allows normal vertical page scroll when at edges
      },
      on: {
        slideChange: function () {
          const steps = document.querySelectorAll('.progress-step');
          steps.forEach((step, index) => {
            step.classList.toggle('active', index === swiper.activeIndex);
          });
        }
      }
    });
    swiper.on('init', () => {
      const steps = document.querySelectorAll('.progress-step');
      if (steps[0]) steps[0].classList.add('active');
    });

    swiper.init(); // If using manual init
  });
  });
</script>
